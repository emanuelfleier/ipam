<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitaci√≥n: Flujo de Devoluciones de Insumos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        [contenteditable]:focus {
            outline: none;
        }
        /* Estilos para animaciones de scroll */
        .flow-step, .rule-card {
            opacity: 0;
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .flow-step {
            transform: translateX(-40px);
        }
        .flow-step.align-right {
             transform: translateX(40px);
        }
        .rule-card {
            transform: translateY(30px);
        }
        .is-visible {
            opacity: 1;
            transform: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Contenedor principal -->
    <div class="container mx-auto p-4 md:p-8">

        <!-- Encabezado -->
        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-5xl font-bold text-teal-700 mb-2">Proceso de Control y Gesti√≥n de Devoluciones     IPAM</h1>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto">Gu√≠a para el correcto manejo de insumos y medicamentos no utilizados por pacientes internados.</p>
        </header>

        <main>
            <!-- Secci√≥n 1: El Flujo B√°sico y Esperado -->
            <section id="flujo-basico" class="mb-16">
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200 overflow-x-hidden">
                    <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2 text-center">‚úÖ El Proceso Ideal: Paso a Paso</h2>
                    <p class="text-center text-slate-500 mb-10">Este es el camino que deben seguir los insumos cuando todo funciona correctamente. Siguiendo estos pasos garantizamos seguridad y eficiencia.</p>
                    
                    <div class="relative">
                        <!-- Conector vertical (solo visible en pantallas grandes) -->
                        <div class="hidden md:block absolute top-8 left-1/2 w-0.5 h-[calc(100%-4rem)] bg-teal-200 -translate-x-1/2"></div>
                        
                        <!-- Contenedor de pasos -->
                        <div class="space-y-12">
                            <!-- Paso 1 -->
                            <div class="flow-step md:grid md:grid-cols-2 md:gap-8 items-center relative">
                                <div class="md:text-right">
                                    <div class="flex items-center md:justify-end mb-4 md:mb-0">
                                         <div class="text-right mr-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Egreso o Cambio de Tratamiento</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Enfermer√≠a</span>
                                        </div>
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">1</div>
                                    </div>
                                </div>
                                <div class="md:border-l-4 border-teal-500 pl-6 text-slate-600">
                                    <p>Al dar el alta m√©dica o modificar una indicaci√≥n, el personal de enfermer√≠a identifica y separa los insumos o medicamentos no utilizados que Farmacia hab√≠a entregado para ese paciente.</p>
                                </div>
                            </div>
                            
                            <!-- Paso 2 -->
                            <div class="flow-step align-right md:grid md:grid-cols-2 md:gap-8 items-center relative">
                               <div class="md:col-start-2 md:text-left">
                                    <div class="flex items-center mb-4 md:mb-0">
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">2</div>
                                        <div class="text-left ml-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Preparaci√≥n de la Devoluci√≥n</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Enfermer√≠a</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="md:col-start-1 md:row-start-1 md:border-r-4 border-teal-500 pr-6 md:text-right text-slate-600">
                                     <p>Se colocan los insumos en una bolsa o caja. Es <strong class="text-red-600">CRUCIAL</strong> identificarla con: Nombre del paciente, habitaci√≥n/cama y fecha. Sin esto, se pierde la trazabilidad.</p>
                                </div>
                            </div>

                            <!-- Paso 3 -->
                            <div class="flow-step md:grid md:grid-cols-2 md:gap-8 items-center relative">
                                <div class="md:text-right">
                                    <div class="flex items-center md:justify-end mb-4 md:mb-0">
                                        <div class="text-right mr-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Retiro por Farmacia</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Farmacia</span>
                                        </div>
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">3</div>
                                    </div>
                                </div>
                                <div class="md:border-l-4 border-teal-500 pl-6 text-slate-600">
                                    <p>En horarios pactados, personal de farmacia realiza el retiro de las devoluciones desde los offices, verificando que cada una est√© correctamente identificada.</p>
                                </div>
                            </div>

                            <!-- Paso 4 -->
                             <div class="flow-step align-right md:grid md:grid-cols-2 md:gap-8 items-center relative">
                               <div class="md:col-start-2 md:text-left">
                                    <div class="flex items-center mb-4 md:mb-0">
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">4</div>
                                        <div class="text-left ml-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Recepci√≥n y Clasificaci√≥n</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Farmacia</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="md:col-start-1 md:row-start-1 md:border-r-4 border-teal-500 pr-6 md:text-right text-slate-600">
                                     <p>El encargado revisa cada producto: que no est√© vencido, abierto o deteriorado. Si est√° en buen estado, se prepara para reintegrar al stock general.</p>
                                </div>
                            </div>

                            <!-- Paso 5 -->
                            <div class="flow-step md:grid md:grid-cols-2 md:gap-8 items-center relative">
                                <div class="md:text-right">
                                    <div class="flex items-center md:justify-end mb-4 md:mb-0">
                                        <div class="text-right mr-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Registro en el Sistema</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Farmacia</span>
                                        </div>
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">5</div>
                                    </div>
                                </div>
                                <div class="md:border-l-4 border-teal-500 pl-6 text-slate-600">
                                    <p>Se registra la devoluci√≥n en el sistema inform√°tico. La cuenta del paciente se ajusta para reflejar lo entregado, lo consumido y lo devuelto. Este paso es vital para la facturaci√≥n.</p>
                                </div>
                            </div>

                            <!-- Paso 6 -->
                             <div class="flow-step align-right md:grid md:grid-cols-2 md:gap-8 items-center relative">
                               <div class="md:col-start-2 md:text-left">
                                    <div class="flex items-center mb-4 md:mb-0">
                                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-600 text-white flex items-center justify-center text-xl font-bold">6</div>
                                        <div class="text-left ml-4">
                                            <h3 class="text-xl font-semibold text-teal-800">Auditor√≠a y Control</h3>
                                            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded">Responsable: Auditor√≠a / Facturaci√≥n</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="md:col-start-1 md:row-start-1 md:border-r-4 border-teal-500 pr-6 md:text-right text-slate-600">
                                     <p>Se valida que no queden saldos sin justificar y que lo facturado coincida con lo efectivamente utilizado por el paciente. Es el cierre final del ciclo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: 5 Reglas de Oro -->
            <section id="reglas-oro" class="mb-16">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2 text-center">üèÜ Reglas Fundamentales</h2>
                <p class="text-center text-slate-500 mb-10">Estas son las reglas inquebrantables que garantizan un proceso seguro y eficiente. ¬°No hay excepciones!</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <!-- Regla 1 -->
                    <div class="rule-card bg-amber-100 border border-amber-200 p-6 rounded-xl text-center shadow-md hover:shadow-xl transition-shadow duration-300">
                        <div class="text-4xl mb-3">üè∑Ô∏è</div>
                        <h3 class="font-bold text-amber-800 text-lg">1. Sin Etiqueta, No Existe</h3>
                        <p class="text-sm text-amber-700 mt-2">Toda devoluci√≥n debe estar perfectamente identificada con los datos del paciente.</p>
                    </div>
                    <!-- Regla 2 -->
                    <div class="rule-card bg-sky-100 border border-sky-200 p-6 rounded-xl text-center shadow-md hover:shadow-xl transition-shadow duration-300" style="transition-delay: 100ms;">
                        <div class="text-4xl mb-3">‚ú®</div>
                        <h3 class="font-bold text-sky-800 text-lg">2. Perfecto Estado</h3>
                        <p class="text-sm text-sky-700 mt-2">Solo se aceptan productos cerrados, sin da√±os y dentro de su fecha de vencimiento.</p>
                    </div>
                    <!-- Regla 3 -->
                    <div class="rule-card bg-lime-100 border border-lime-200 p-6 rounded-xl text-center shadow-md hover:shadow-xl transition-shadow duration-300" style="transition-delay: 200ms;">
                        <div class="text-4xl mb-3">üîÑ</div>
                        <h3 class="font-bold text-lime-800 text-lg">3. F√≠sico = Digital</h3>
                        <p class="text-sm text-lime-700 mt-2">Toda devoluci√≥n f√≠sica debe tener su correspondiente registro en el sistema.</p>
                    </div>
                    <!-- Regla 4 -->
                    <div class="rule-card bg-violet-100 border border-violet-200 p-6 rounded-xl text-center shadow-md hover:shadow-xl transition-shadow duration-300" style="transition-delay: 300ms;">
                        <div class="text-4xl mb-3">‚ùÑÔ∏è</div>
                        <h3 class="font-bold text-violet-800 text-lg">4. Prioridad Especial</h3>
                        <p class="text-sm text-violet-700 mt-2">Los medicamentos especiales (ej. cadena de fr√≠o) se procesan con m√°xima urgencia.</p>
                    </div>
                    <!-- Regla 5 -->
                    <div class="rule-card bg-rose-100 border border-rose-200 p-6 rounded-xl text-center shadow-md hover:shadow-xl transition-shadow duration-300" style="transition-delay: 400ms;">
                        <div class="text-4xl mb-3">‚ùì</div>
                        <h3 class="font-bold text-rose-800 text-lg">5. Ante la Duda, se Rechaza</h3>
                        <p class="text-sm text-rose-700 mt-2">Si algo parece incorrecto, se separa, se rechaza y se consulta con un supervisor.</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Caminos Alternativos y Problemas Comunes -->
            <section id="caminos-alternativos">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2 text-center">ü§î Caminos Alternativos y Problemas Comunes</h2>
                <p class="text-center text-slate-500 mb-10">¬øQu√© pasa cuando algo no sale como se esperaba? Analicemos los errores m√°s frecuentes para aprender a evitarlos y solucionarlos.</p>
                
                <div class="space-y-4" id="accordion-container">
                    <!-- Los items del acorde√≥n se insertar√°n aqu√≠ con JavaScript -->
                </div>
            </section>

            <!-- Secci√≥n de Guardado -->
             <section id="save-section" class="mt-12 text-center">
                <button id="saveButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50">
                    Guardar Cambios
                </button>
                <p id="saveNotification" class="text-green-600 mt-4 h-6 transition-opacity duration-300 opacity-0"></p>
            </section>

        </main>
        
        <!-- Footer -->
        <footer class="text-center mt-16 py-6 border-t border-slate-200">
            <p class="text-slate-500">Documentaci√≥n de Capacitaci√≥n Interna.</p>
        </footer>

    </div>

    <script>
        const problemas = [
            {
                titulo: "A. Lo devuelto no fue registrado en sistema por enfermer√≠a",
                situacion: "Se devuelve f√≠sicamente un insumo, pero el personal de enfermer√≠a no registr√≥ la devoluci√≥n en el sistema.",
                consecuencia: "El sistema muestra saldo sin devolver, y no refleja correctamente el movimiento real.",
                accion: "Registrar la devoluci√≥n retroactivamente, dejando constancia del motivo y validaci√≥n del responsable.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m-1.125.125a3.375 3.375 0 01-3.375 3.375v6.75a3.375 3.375 0 013.375 3.375h9a3.375 3.375 0 013.375-3.375v-6.75a3.375 3.375 0 01-3.375-3.375H8.25" /></svg>`
            },
            {
                titulo: "B. Se devuelve un producto ya cargado como consumido",
                situacion: "Enfermer√≠a registra el insumo como administrado y tambi√©n lo devuelve f√≠sicamente.",
                consecuencia: "El sistema indicar√≠a que se us√≥, pero tambi√©n que volvi√≥ al stock ‚Üí riesgo de error o fraude.",
                accion: "Rechazar la devoluci√≥n, dejar constancia del error y notificar al supervisor de enfermer√≠a.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 12L3 8m4 8l4-8m11 4h-5m5 0l-2-2m2 2l-2 2" /></svg>`
            },
            {
                titulo: "C. Cantidad devuelta no coincide con el saldo entregado",
                situacion: "Se entregaron 10 unidades, se consumieron 5, pero solo se devuelven 2.",
                consecuencia: "Quedan unidades sin justificar ‚Üí posible p√©rdida, omisi√≥n o mal registro.",
                accion: "Registrar la diferencia como inconsistencia y auditar el evento si el desv√≠o es repetido.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>`
            },
            {
                titulo: "D. Bolsa sin identificaci√≥n del paciente",
                situacion: "Farmacia recibe una bolsa con insumos devueltos sin ninguna identificaci√≥n de a qu√© paciente corresponden.",
                consecuencia: "No se puede asignar al evento ‚Üí se pierde trazabilidad y no se puede ajustar la cuenta del paciente.",
                accion: "Registrar como devoluci√≥n gen√©rica o rechazar seg√∫n protocolo. Reforzar la capacitaci√≥n sobre la importancia del etiquetado.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-1.5h5.25m-5.25 0h-1.5m-3 0h1.5m0 0h5.25m-5.25 0h-1.5m-3 0h1.5M9 12l-1.5 1.5L6 12m6 0l-1.5 1.5L12 12" /></svg>`
            },
            {
                titulo: "E. Producto vencido, abierto o deteriorado",
                situacion: "Se devuelve un insumo vencido, con envase abierto o que presenta deterioro.",
                consecuencia: "No puede ser reincorporado al stock ‚Üí merma obligatoria.",
                accion: "Registrar como merma y desechar seg√∫n protocolo de residuos sanitarios.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
            },
             {
                titulo: "F. Producto devuelto no corresponde al paciente indicado",
                situacion: "El insumo no coincide con lo que se entreg√≥ al paciente que figura en la bolsa.",
                consecuencia: "Error de identificaci√≥n, riesgo de cruzar stocks entre pacientes.",
                accion: "No reintegrar el producto hasta validar con el sector de enfermer√≠a.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 15l-6 6m0-6l6 6m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
            },
             {
                titulo: "H. Devoluciones mezcladas de varios pacientes en una misma bolsa",
                situacion: "Se entrega una √∫nica bolsa con productos de varios pacientes sin separarlos ni identificarlos.",
                consecuencia: "No se pueden asignar correctamente los insumos ‚Üí p√©rdida de trazabilidad.",
                accion: "Procesar como devoluci√≥n gen√©rica o rechazarla hasta que se identifiquen los insumos.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>`
            },
             {
                titulo: "I. Farmacia no retira devoluciones en el horario pactado",
                situacion: "Por sobrecarga o urgencia, el personal de farmacia no pasa a retirar las devoluciones seg√∫n lo establecido.",
                consecuencia: "Se acumulan devoluciones, riesgo de extrav√≠o o mezcla entre pacientes.",
                accion: "Reprogramar el retiro, dejar nota en el office y reforzar seguimiento.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
            },
             {
                titulo: "J. Enfermer√≠a no prepara la devoluci√≥n al egreso",
                situacion: "El paciente es dado de alta y el equipo de enfermer√≠a olvida separar los insumos sobrantes.",
                consecuencia: "No se devuelven los productos no utilizados y se facturan como si se hubieran consumido.",
                accion: "Incluir el control de devoluciones como parte del checklist de egreso obligatorio.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>`
            },
            {
                titulo: "O. Medicamento termol√°bil sin condiciones de conservaci√≥n",
                situacion: "Se devuelve un medicamento que requiere cadena de fr√≠o pero fue dejado fuera de la heladera sin control.",
                consecuencia: "El producto pierde su efectividad y no se puede reutilizar ‚Üí merma obligatoria.",
                accion: "Rechazar devoluci√≥n, notificar inmediatamente al sector y registrar la p√©rdida.",
                icon: `<svg class="w-6 h-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 2v20m5.657-14.343l-11.314 11.314M6.343 6.343l11.314 11.314m0-11.314L6.343 17.657m11.314-11.314L6.343 6.343z" /></svg>`
            }
        ];

        const accordionContainer = document.getElementById('accordion-container');

        // --- Generaci√≥n del Acorde√≥n ---
        problemas.forEach((problema) => {
            const problemaId = problema.titulo.split('.')[0].trim(); // "A", "B", "C", etc.
            const item = document.createElement('div');
            item.className = 'bg-white border border-slate-200 rounded-lg shadow-sm';

            item.innerHTML = `
                <button class="accordion-header w-full flex justify-between items-center text-left p-4 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50 rounded-lg">
                    <div class="flex items-center">
                        <span class="mr-3">${problema.icon}</span>
                        <span class="text-lg font-semibold text-slate-700">${problema.titulo}</span>
                    </div>
                    <svg class="w-6 h-6 transform transition-transform chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
                <div class="accordion-content">
                    <div class="px-4 pb-4 pt-2">
                        <div class="p-4 rounded-lg bg-red-50 border border-red-200 mb-3">
                            <h4 class="font-bold text-red-800">Situaci√≥n (editable):</h4>
                            <div id="${problemaId}-situacion" contenteditable="true" class="editable-field text-red-800 bg-white mt-1 p-2 rounded border border-red-300 focus:ring-2 focus:ring-red-400 min-h-[50px]">${problema.situacion}</div>
                            <h4 class="font-bold text-red-800 mt-3">Consecuencia (editable):</h4>
                            <div id="${problemaId}-consecuencia" contenteditable="true" class="editable-field text-red-800 bg-white mt-1 p-2 rounded border border-red-300 focus:ring-2 focus:ring-red-400 min-h-[50px]">${problema.consecuencia}</div>
                        </div>
                        <div class="p-4 rounded-lg bg-green-50 border border-green-200">
                             <h4 class="font-bold text-green-800">Acci√≥n Correctiva y Reflexi√≥n (editable):</h4>
                             <div id="${problemaId}-accion" contenteditable="true" class="editable-field text-green-800 bg-white mt-1 p-2 rounded border border-green-300 focus:ring-2 focus:ring-green-400 min-h-[50px]">
                                ${problema.accion}
                             </div>
                        </div>
                    </div>
                </div>
            `;
            accordionContainer.appendChild(item);
        });

        // --- L√≥gica del Acorde√≥n ---
        const accordionHeaders = document.querySelectorAll('.accordion-header');
        accordionHeaders.forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const chevron = header.querySelector('.chevron');
                accordionHeaders.forEach(otherHeader => {
                    if (otherHeader !== header) {
                        otherHeader.nextElementSibling.style.maxHeight = null;
                        otherHeader.querySelector('.chevron').classList.remove('rotate-180');
                    }
                });
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    chevron.classList.remove('rotate-180');
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    chevron.classList.add('rotate-180');
                }
            });
        });

        // --- L√≥gica de Guardado y Carga ---
        const saveButton = document.getElementById('saveButton');
        const saveNotification = document.getElementById('saveNotification');
        const editableFields = document.querySelectorAll('.editable-field');

        // Funci√≥n para guardar los cambios
        saveButton.addEventListener('click', () => {
            editableFields.forEach(field => {
                localStorage.setItem(field.id, field.innerHTML);
            });

            saveNotification.textContent = '¬°Cambios guardados exitosamente!';
            saveNotification.classList.remove('opacity-0');

            setTimeout(() => {
                saveNotification.classList.add('opacity-0');
            }, 3000);
        });

        // Funci√≥n para cargar los datos al iniciar la p√°gina
        const loadSavedData = () => {
            editableFields.forEach(field => {
                const savedContent = localStorage.getItem(field.id);
                if (savedContent) {
                    field.innerHTML = savedContent;
                }
            });
        };

        // --- L√≥gica de Animaciones y Carga Inicial ---
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar datos guardados primero
            loadSavedData();
            
            if ("IntersectionObserver" in window) {
                const observer = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.2 });

                const elementsToAnimate = document.querySelectorAll('.flow-step, .rule-card');
                elementsToAnimate.forEach(el => observer.observe(el));
                
            } else {
                // Fallback for older browsers
                const elementsToAnimate = document.querySelectorAll('.flow-step, .rule-card');
                elementsToAnimate.forEach(el => el.classList.add('is-visible'));
            }
        });

    </script>
</body>
</html>

